# {{ ansible_managed }}
# ansibleguy.infra_openvpn

[Unit]
Description=OpenVPN server '%I'
Documentation=https://github.com/ansibleguy/infra_openvpn

{% set path_instance = OVPN_CONFIG.path.base + '/' + OVPN_CONFIG.prefix_instance %}
[Service]
WorkingDirectory={{ path_instance }}%I
ExecStart=
ExecStart=/usr/sbin/openvpn --daemon openvpn_%I --cd {{ path_instance }}%I/ --config {{ path_instance }}%I/server.conf --writepid {{ OVPN_HC.path.run }}/{{ OVPN_CONFIG.prefix_instance }}%I.pid
PIDFile={{ OVPN_HC.path.run }}/{{ OVPN_CONFIG.prefix_instance }}%I.pid

CapabilityBoundingSet=CAP_IPC_LOCK CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW CAP_SYS_CHROOT CAP_DAC_OVERRIDE CAP_AUDIT_WRITE
# todo: add 'CAP_SETGID CAP_SETUID' if totp is used

{% if ansible_distribution_major_version == "10" %}
StandardOutput=syslog
StandardError=syslog
{% else %}
StandardOutput=journal
StandardError=journal
{% endif %}
SyslogIdentifier=openvpn_%I

Environment=PYTHONUNBUFFERED=1
